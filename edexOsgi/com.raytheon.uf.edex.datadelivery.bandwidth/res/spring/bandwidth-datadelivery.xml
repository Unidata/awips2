<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd">

	<bean id="propertyPlaceholderConfigurer"
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="locations">
			<list>
				<value>classpath:/com.raytheon.uf.edex.datadelivery.bandwidth.properties
				</value>
			</list>
		</property>
	</bean>
    
    <bean id="bandwidthEventBus" class="com.raytheon.uf.edex.datadelivery.bandwidth.notification.BandwidthEventBusBean" />

	<bean id="bandwidthDao" factory-bean="bandwidthContextFactory"
		factory-method="getBandwidthDao" />

	<bean id="bandwidthDbInit" factory-bean="bandwidthContextFactory"
        factory-method="getBandwidthDbInit" />

	<bean id="bandwidthManagerInitializer" factory-bean="bandwidthContextFactory"
		factory-method="getBandwidthInitializer" depends-on="registryManagerInstanceInitializer">
	</bean>

	<bean id="bandwidthMapConfigFile" factory-bean="bandwidthContextFactory"
		factory-method="getBandwidthMapConfigFile" />

	<bean id="bandwidthManager" factory-bean="bandwidthContextFactory"
		factory-method="getBandwidthManager"
		depends-on="BandwidthEventBusConfig,bandwidthUtil,registerDataDeliveryHandlers"
		init-method="init">
		<constructor-arg ref="bandwidthDbInit" />
		<constructor-arg ref="bandwidthDao" />
		<constructor-arg ref="retrievalManager" />
		<constructor-arg ref="bandwidthDaoUtil" />
		<property name="aggregator" ref="aggregator" />
		<property name="initializer" ref="bandwidthManagerInitializer" />
	</bean>

	<bean id="dataSetAvailabilityCalculator"
		class="com.raytheon.uf.edex.datadelivery.bandwidth.util.SimpleAvailablityCalculator">
		<property name="delay"
			value="${bandwidth.dataSetAvailabilityCalculator.delay}" />
	</bean>

	<bean id="bandwidthUtil"
		class="com.raytheon.uf.edex.datadelivery.bandwidth.util.BandwidthUtil"
		factory-method="getInstance">
		<property name="dataSetAvailabilityCalculator" ref="dataSetAvailabilityCalculator" />
		<property name="subscriptionLatencyCalculator">
			<bean
				class="com.raytheon.uf.edex.datadelivery.bandwidth.util.SubscriptionValueLatencyCalculator" />
		</property>
		<property name="subscriptionRescheduleStrategy">
			<bean
				class="com.raytheon.uf.edex.datadelivery.bandwidth.util.AlwaysRescheduleSubscriptions" />
		</property>
	</bean>

	<bean id="bandwidthDaoUtil"
		class="com.raytheon.uf.edex.datadelivery.bandwidth.util.BandwidthDaoUtil">
		<constructor-arg ref="bandwidthDao" />
		<constructor-arg ref="retrievalManager" />
	</bean>

	<bean id="BandwidthMap"
		class="com.raytheon.uf.edex.datadelivery.bandwidth.retrieval.BandwidthMap"
		factory-method="load">
		<constructor-arg ref="bandwidthMapConfigFile" />
	</bean>

	<bean id="aggregator"
		class="com.raytheon.uf.edex.datadelivery.bandwidth.processing.SimpleSubscriptionAggregator">
		<constructor-arg ref="bandwidthDao" />
	</bean>

	<bean id="BandwidthEventBusConfig"
		class="com.raytheon.uf.edex.datadelivery.bandwidth.notification.BandwidthEventBusConfig">
		<property name="dataSetMetaDataPoolSize" value="${bandwidth.dataSetMetaDataPoolSize}" />
		<property name="retrievalPoolSize" value="${bandwidth.retrievalPoolSize}" />
		<property name="subscriptionPoolSize" value="${bandwidth.subscriptionPoolSize}" />
	</bean>

	<!-- The shared monitor object between the RetrievalAgentManager and its 
		Agents -->
	<bean id="retrievalAgentNotifier" class="java.lang.Object" />

	<bean id="retrievalAgentManager"
		class="com.raytheon.uf.edex.datadelivery.bandwidth.retrieval.RetrievalAgentManager"
		init-method="start">
		<constructor-arg ref="retrievalAgentNotifier" />
		<constructor-arg ref="retrievalAgents" />
		<constructor-arg ref="retrievalDao" />
	</bean>

	<bean id="retrievalManager"
		class="com.raytheon.uf.edex.datadelivery.bandwidth.retrieval.RetrievalManager"
		depends-on="bandwidthDbInit">
		<constructor-arg ref="bandwidthDao" />
		<constructor-arg ref="retrievalAgentNotifier" />
		<property name="retrievalPlans" ref="retrievalPlans" />
	</bean>

	<bean id="BandwidthManagerProcessor"
		class="com.raytheon.uf.edex.datadelivery.bandwidth.processing.Processor" />
	<bean id="BandwidthManagerRetrieval"
		class="com.raytheon.uf.edex.datadelivery.retrieval.RetrievalGenerationHandler">
		<constructor-arg ref="retrievalDao" />
	</bean>
	<bean id="SubscriptionBundleSeparator"
		class="com.raytheon.uf.edex.datadelivery.bandwidth.separator.SubscriptionBundleSeparator" />
</beans>
